<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>IMMMOR // NEURAL_ORB_v10</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

    <style>
        :root {
            --orb-color: #ffb000;
            --orb-glow: rgba(255, 176, 0, 0.4);
            --bg: #0a0a0a;
            --glass: rgba(20, 18, 12, 0.85);
            --neon-green: #00ff41;
            --neon-red: #ff3e3e;
        }

        body, html {
            margin: 0; padding: 0; height: 100vh; width: 100vw;
            background: var(--bg); color: var(--orb-color);
            font-family: 'Fira Code', 'Courier New', monospace; overflow: hidden;
        }

        /* èƒŒæ™¯æµä½“åŠ¨ç”» */
        .bg-gradient {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 90% 90%, #1a1500 0%, transparent 40%);
            z-index: -1;
        }

        /* å¸ƒå±€ */
        .workspace { display: flex; height: 100vh; padding: 10px; gap: 10px; }

        /* å·¦ä¾§æè‡´ç²¾ç®€ */
        .side-nav { width: 50px; display: flex; flex-direction: column; align-items: center; gap: 20px; padding-top: 20px; background: rgba(0,0,0,0.3); border-radius: 25px; }
        .nav-icon { width: 30px; height: 30px; cursor: pointer; opacity: 0.5; transition: 0.3s; }
        .nav-icon:hover { opacity: 1; transform: scale(1.2); }

        /* ç¼–è¾‘å™¨ä¸»åŒº - æ‚¬æµ®å¡ç‰‡æ„Ÿ */
        .editor-container { 
            flex: 1; background: var(--glass); border-radius: 20px; 
            border: 1px solid rgba(255,176,0,0.1); display: flex; flex-direction: column;
            overflow: hidden; position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        #editor {
            flex: 1; background: transparent; color: #fff; border: none;
            padding: 30px; font-size: 16px; outline: none; resize: none; line-height: 1.6;
        }

        /* --- AI ç¥ç»å…ƒæ ¸å¿ƒ (é‡ç‚¹) --- */
        .ai-core-wrapper {
            position: fixed; bottom: 40px; right: 40px; z-index: 1000;
        }

        /* æ ¸å¿ƒçƒä½“ */
        .orb {
            width: 60px; height: 60px; background: var(--orb-color);
            border-radius: 50%; cursor: pointer;
            box-shadow: 0 0 20px var(--orb-glow), inset 0 0 15px rgba(255,255,255,0.5);
            animation: orb-pulse 2s infinite ease-in-out;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: #000; font-size: 10px;
        }
        @keyframes orb-pulse {
            0% { transform: scale(1); box-shadow: 0 0 20px var(--orb-glow); }
            50% { transform: scale(1.1); box-shadow: 0 0 40px var(--orb-glow); }
            100% { transform: scale(1); box-shadow: 0 0 20px var(--orb-glow); }
        }

        /* ç¯å½¢èœå• */
        .orb-menu {
            position: absolute; bottom: 0; right: 0; width: 200px; height: 200px;
            pointer-events: none; opacity: 0; transition: 0.4s; transform: scale(0.5) rotate(-90deg);
        }
        .ai-core-wrapper:hover .orb-menu {
            opacity: 1; pointer-events: auto; transform: scale(1.1) rotate(0deg);
        }

        .menu-item {
            position: absolute; width: 45px; height: 45px; background: var(--glass);
            border: 1px solid var(--orb-color); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; cursor: pointer; transition: 0.2s;
        }
        .menu-item:hover { background: var(--orb-color); color: #000; }
        .m-1 { top: 0; left: 75px; }     /* é¡¶éƒ¨ï¼šè§£é‡Š */
        .m-2 { top: 40px; left: 15px; }  /* å·¦ï¼šDEBUG */
        .m-3 { top: 110px; left: 15px; } /* å·¦ä¸‹ï¼šé‡æ„ */

        /* å¼¹å‡ºå¼å¯¹è¯é¢æ¿ - åƒä» Orb å–·å°„å‡ºæ¥çš„æ°”æ³¡ */
        #ai-dialog {
            position: absolute; bottom: 80px; right: 0; width: 350px; max-height: 500px;
            background: var(--glass); border: 1px solid var(--orb-color);
            border-radius: 20px 20px 0 20px; display: none; flex-direction: column;
            box-shadow: 0 15px 40px rgba(0,0,0,0.8); backdrop-filter: blur(10px);
        }

        .dialog-chat { flex: 1; overflow-y: auto; padding: 15px; font-size: 13px; }
        .bubble { 
            margin-bottom: 12px; padding: 10px; border-radius: 12px; 
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
        }
        .bubble.ai { border-left: 3px solid var(--neon-green); }
        .bubble pre { background: #000 !important; padding: 10px; border-radius: 8px; margin-top: 8px; font-size: 12px; }

        .dialog-input {
            padding: 10px; border-top: 1px solid rgba(255,255,255,0.1); display: flex;
        }
        #ai-text {
            flex: 1; background: transparent; border: none; color: #fff; outline: none; padding: 5px;
        }

        /* ç»ˆç«¯é¢æ¿ */
        .terminal-panel {
            height: 150px; background: rgba(0,0,0,0.6); margin-top: 10px;
            border-radius: 20px; padding: 15px; font-size: 12px; color: var(--neon-green);
            overflow-y: auto; border: 1px solid rgba(0,255,65,0.1);
        }

        /* Diff åŠ¨ç”»æ ·å¼ */
        .line-diff-add { color: var(--neon-green); background: rgba(0,255,65,0.1); animation: highlight 1s forwards; }
        @keyframes highlight { from { background: rgba(0,255,65,0.4); } to { background: rgba(0,255,65,0.1); } }
    </style>
</head>
<body>

<div class="bg-gradient"></div>

<div class="workspace">
    <nav class="side-nav">
        <div class="nav-icon" title="Files">ğŸ“‚</div>
        <div class="nav-icon" title="Python">ğŸ</div>
        <div class="nav-icon" title="Plugins">ğŸ§©</div>
    </nav>

    <div style="flex: 1; display: flex; flex-direction: column;">
        <div class="editor-container">
            <div style="padding: 10px 20px; font-size: 10px; background: rgba(0,0,0,0.2); display: flex; justify-content: space-between;">
                <span>FILE: main.js</span>
                <span id="ai-status">CORE_STABLE</span>
            </div>
            <textarea id="editor" spellcheck="false" onkeydown="handleKeys(event)">
function neural_process() {
    console.log("Waiting for AI commands...");
    // é€‰ä¸­è¿™æ®µä»£ç ï¼Œçœ‹å³ä¸‹è§’ Orb
}
            </textarea>
        </div>

        <div class="terminal-panel" id="term-out">
            > Neural Engine v10.0 Online.<br>
            > Waiting for connection pulse...
        </div>
    </div>
</div>

<div class="ai-core-wrapper">
    <div class="orb-menu">
        <div class="menu-item m-1" onclick="quickAction('Explain')">EXPLAIN</div>
        <div class="menu-item m-2" onclick="quickAction('Debug')">DEBUG</div>
        <div class="menu-item m-3" onclick="quickAction('Refactor')">CLEAN</div>
    </div>

    <div id="ai-dialog">
        <div class="dialog-chat" id="chat-flow">
            <div class="bubble ai">Neural Link established. Command me.</div>
        </div>
        <div class="dialog-input">
            <input type="text" id="ai-text" placeholder="Pulse input..." autocomplete="off">
            <button onclick="sendAi()" style="background:var(--orb-color); border:none; border-radius:5px; cursor:pointer">SYNC</button>
        </div>
    </div>

    <div class="orb" onclick="toggleDialog()">CORE</div>
</div>

<script>
    const editor = document.getElementById('editor');
    const chatFlow = document.getElementById('chat-flow');
    const aiText = document.getElementById('ai-text');
    const aiDialog = document.getElementById('ai-dialog');

    marked.setOptions({
        highlight: (code) => Prism.highlight(code, Prism.languages.javascript, 'javascript')
    });

    // 1. åˆ‡æ¢å¯¹è¯æ¡†æ˜¾ç¤º
    function toggleDialog() {
        const isNone = aiDialog.style.display === 'none' || aiDialog.style.display === '';
        aiDialog.style.display = isNone ? 'flex' : 'none';
        if(isNone) aiText.focus();
    }

    // 2. AI æ ¸å¿ƒåŠ¨ä½œ
    async function sendAi() {
        const val = aiText.value;
        if(!val) return;
        addBubble('user', val);
        aiText.value = '';

        // ä¿®æ”¹ Orb çŠ¶æ€ä¸ºâ€œæ€è€ƒâ€ (çº¢è‰²è„‰å†²)
        document.querySelector('.orb').style.backgroundColor = 'var(--neon-green)';
        
        setTimeout(() => {
            const mockCode = `function neural_process() {\n    const flow = "SYNCED";\n    console.info(\`System Flow: \${flow}\`);\n}`;
            const res = `è§£æå®Œæˆã€‚æˆ‘å·²åŒæ­¥äº†ç¥ç»å…ƒé€»è¾‘ï¼š\n\n\`\`\`javascript\n${mockCode}\n\`\`\``;
            const bubble = addBubble('ai', marked.parse(res));
            
            // ä»£ç æ³¨å…¥æŒ‰é’®
            bubble.querySelectorAll('pre').forEach(pre => {
                pre.style.cursor = 'pointer';
                pre.title = 'Click to Inject Code';
                pre.onclick = () => {
                    editor.value = pre.innerText;
                    log("Code synced from AI memory.");
                    toggleDialog();
                };
            });
            
            document.querySelector('.orb').style.backgroundColor = 'var(--orb-color)';
            Prism.highlightAll();
        }, 1000);
    }

    function quickAction(type) {
        aiText.value = `${type} this code.`;
        sendAi();
    }

    // 3. è¾…åŠ©åŠŸèƒ½
    function addBubble(role, content) {
        const div = document.createElement('div');
        div.className = `bubble ${role}`;
        div.innerHTML = `<b>${role.toUpperCase()}:</b><br>${content}`;
        chatFlow.appendChild(div);
        chatFlow.scrollTop = chatFlow.scrollHeight;
        return div;
    }

    function log(msg) {
        const line = document.createElement('div');
        line.innerHTML = `> [${new Date().toLocaleTimeString()}] ${msg}`;
        document.getElementById('term-out').appendChild(line);
        document.getElementById('term-out').scrollTop = 10000;
    }

    function handleKeys(e) {
        if(e.ctrlKey && e.key === 'i') { e.preventDefault(); toggleDialog(); }
        if(e.key === 'Enter' && aiDialog.style.display === 'flex') { sendAi(); }
    }

    // é›†æˆåŸæœ‰æ’ä»¶/Python é€»è¾‘æ¥å£
    function initOldModules() {
        log("Checking legacy plugin compatibility...");
        log("Python 3.10 Runtime Ready (WASM)");
    }
    initOldModules();

</script>
</body>
</html>