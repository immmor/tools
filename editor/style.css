        :root {
            /* --amber: #ffb000;
            --amber-dim: #714e00;
            --bg: #12100b;
            --panel-bg: #1c1912;
            --border-w: 2px;
            --term-red: #ff3e3e;
            --term-green: #00ff41; */
            --amber: #00ff9d !important;         /* 幽灵绿 */
            --amber-dim: #003320 !important;     /* 深绿背景 */
            --bg: #050505 !important;            /* 极黑 */
            --panel-bg: #0d0d0d !important; 
            --border-w: 2px;     /* 灰黑面板 */
            --term-red: #555 !important;
            --term-green: #00ff41;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; cursor: default; }
        
        body, html {
            margin: 0; padding: 0; height: 100vh; width: 100vw;
            background: var(--bg); color: var(--amber);
            font-family: 'Courier New', Courier, monospace; overflow: hidden;
            background-image: linear-gradient(rgba(18, 16, 11, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 255, 0, 0.06));
            background-size: 100% 4px, 3px 100%;
        }

        .header {
            height: 40px; border-bottom: var(--border-w) solid var(--amber);
            display: flex; align-items: center; padding: 0 15px;
            font-size: 14px; font-weight: bold; background: var(--panel-bg);
            text-shadow: 0 0 5px var(--amber); gap: 20px;
        }

        .menu-btn { cursor: pointer !important; padding: 5px 10px; border: 1px solid transparent; }
        .menu-btn:hover { border-color: var(--amber); background: rgba(255, 176, 0, 0.1); }

        .workspace { display: flex; flex-direction: row; height: calc(100vh - 40px); width: 100%; position: relative; }

        .panel { 
            background: var(--panel-bg); display: flex; flex-direction: column; 
            overflow: hidden; position: relative; height: 100%;
        }

        .panel.maximized {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;   /* 必须设为0，确保从屏幕最左边开始 */
            width: 100vw !important; /* 占据整个屏幕宽度 */
            height: 100vh !important; /* 占据整个屏幕高度 */
            z-index: 999 !important; /* 确保层级高于一切 */
            background: var(--bg) !important; /* 背景不透明，遮住底下的编辑器 */
            display: flex !important;
            flex-direction: column !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        .panel.maximized .p-head {
            height: 40px !important;
            flex-shrink: 0 !important;
        }
        
        .panel.maximized .term-tabs {
            height: 30px !important;
            flex-shrink: 0 !important;
        }
        
        .panel.maximized #editor-container,
        .panel.maximized #ai-container,
        .panel.maximized #term-container {
            flex: 1 !important;
            overflow: auto !important;
        }
        
        .panel.maximized {
            border-left: none !important;
            border-right: none !important;
        }
        
        .panel.maximized .p-head {
            position: relative;
            height: 40px !important;
        }
        
        .panel-tabs {
            position: absolute;
            top: 40px;
            left: 0;
            right: 0;
            display: flex;
            background: var(--panel-bg);
            border-bottom: 1px solid var(--amber-dim);
            height: 30px;
            z-index: 0;
        }
        
        .panel-tab {
            flex: 1;
            padding: 6px 12px;
            text-align: center;
            cursor: pointer;
            border-right: 1px solid var(--amber-dim);
            transition: background 0.2s;
            font-size: 11px;
            line-height: 18px;
        }
        
        .panel-tab:last-child {
            border-right: none;
        }
        
        .panel-tab:hover {
            background: var(--amber-dim);
        }
        
        .panel-tab.active {
            background: var(--amber);
            color: #000;
        }
        
        /* 为面板切换tab栏留出空间 */
        .panel.maximized .term-tabs {
            margin-top: 30px !important;
        }
        
        /* 确保快捷键按钮在终端标签下方 */
        .panel.maximized .editor-tools {
            margin-top: 0 !important;
            z-index: 1 !important;
            position: relative !important;
        }
        
        .panel.maximized #file-list {
            margin-top: 30px !important;
            height: calc(100% - 70px) !important;
        }
        
        .panel.maximized #search-container {
            margin-top: 30px !important;
            position: relative !important;
            z-index: 2 !important;
        }
        
        .panel.maximized #search-results {
            margin-top: 0px !important; /* 修复全屏模式下的顶部空白 */
            height: calc(100% - 110px) !important;
        }

        /* 双竖杠选区拉杆样式 */
        .selection-handle {
            position: fixed;
            width: 2px;
            height: 20px;
            background-color: var(--amber);
            z-index: 1000;
            display: none; /* 默认隐藏 */
            pointer-events: auto;
        }
        /* 拉杆下方的圆点 */
        .selection-handle::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: var(--amber);
            border-radius: 50%;
        }
        /* 增加触摸感应区域 */
        .selection-handle.start::after { 
            top: -8px; 
            left: -5px;
        } /* 起始点圆点在上 */
        .selection-handle.end::after { 
            bottom: -8px; 
            left: -5px;
        } /* 结束点圆点在下 */

        /* AI面板tab加载动画效果 */
        .term-tab.loading {
            position: relative;
            overflow: hidden;
            background: linear-gradient(90deg, 
                var(--amber-dim) 0%, 
                var(--amber) 25%, 
                var(--amber-dim) 50%, 
                var(--amber) 75%, 
                var(--amber-dim) 100%);
            background-size: 200% 100%;
            animation: loading-shimmer 2s infinite linear;
            box-shadow: 0 0 10px var(--amber), 0 0 20px var(--amber);
            border: 1px solid var(--amber);
            min-width: 100px; /* 防止宽度被压缩 */
            flex-shrink: 0; /* 禁止收缩 */
        }

        .term-tab.loading::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            animation: loading-sweep 1.5s infinite;
        }

        .term-tab.loading .pulse-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            background: var(--term-green);
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse-dot 1.5s infinite;
            box-shadow: 0 0 5px var(--term-green);
        }

        @keyframes loading-shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        @keyframes loading-sweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes pulse-dot {
            0%, 100% { 
                transform: scale(1); 
                opacity: 1; 
            }
            50% { 
                transform: scale(1.5); 
                opacity: 0.7; 
            }
        }

        .term-tab.loading .thinking-text {
            background: linear-gradient(90deg, var(--amber), var(--term-green), var(--amber));
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: text-shimmer 2s infinite linear;
        }

        @keyframes text-shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .divider-h { width: 6px; background: var(--amber-dim); cursor: col-resize !important; flex-shrink: 0; }
        .divider-h:hover, .divider-h.active { background: var(--amber); box-shadow: 0 0 10px var(--amber); }

        .divider-v { height: 6px; background: var(--amber-dim); cursor: row-resize !important; flex-shrink: 0; }
        .divider-v:hover, .divider-v.active { background: var(--amber); box-shadow: 0 0 10px var(--amber); }

        .p-head {
            height: 30px; border-bottom: 1px solid var(--amber-dim);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 10px; font-size: 11px; background: rgba(113, 78, 0, 0.1);
        }
        .ctrl-group { display: flex; gap: 5px; }
        .ctrl { 
            cursor: pointer !important; 
            width: 18px; height: 18px;
            display: flex; align-items: center; justify-content: center;
            border: 1px solid var(--amber-dim); 
            font-size: 10px;
            line-height: 1;
        }
        .ctrl:hover { background: var(--amber); color: var(--bg); }

        #explorer { 
            width: 200px; 
            border-right: 1px solid var(--amber-dim); 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
        }
        #file-section, #plugin-section {
            min-height: 0;
            overflow: hidden;
        }
        #file-list, #plugin-list { overflow-y: auto; flex: 1; }
        #plugin-section { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            min-height: 50px;
        }
        .file-item, .plugin-item { 
            padding: 8px 15px; font-size: 13px; cursor: pointer !important; 
            border-bottom: 1px solid rgba(113, 78, 0, 0.05); 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            display: flex; align-items: center; 
            color: var(--amber); opacity: 0.7; 
        }
        .file-item:hover, .plugin-item:hover { background: rgba(255, 176, 0, 0.05); opacity: 0.9; }
        .file-item.active { background: var(--amber); color: var(--bg) !important; font-weight: bold; opacity: 1; }
        .file-item.folder { color: var(--amber); font-weight: bold; opacity: 1; border-left: 2px solid var(--amber-dim); }

        .plugin-item { justify-content: space-between; font-size: 11px; }
        .plugin-status { width: 8px; height: 8px; border-radius: 50%; background: var(--amber-dim); }
        .plugin-status.active { background: var(--term-green); box-shadow: 0 0 5px var(--term-green); }

        .file-rename-input {
            background: var(--amber); color: var(--bg); border: none; outline: none;
            font-family: inherit; font-size: 13px; width: 100%; padding: 0; margin: 0; font-weight: bold;
        }

        #main-stack { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        #editor {
            flex: 1; background: transparent; border: none; outline: none;
            padding: 20px; color: var(--amber); font-size: 16px;
            line-height: 1.5; resize: none; font-family: inherit; cursor: text !important;
        }

        #terminal { height: 220px; }
        .term-tabs { display: flex; background: #000; border-bottom: 1px solid var(--amber-dim); overflow-x: auto; scrollbar-width: none; }
        .term-tabs::-webkit-scrollbar { display: none; }
        .term-tab { 
            padding: 5px 12px; font-size: 10px; border-right: 1px solid var(--amber-dim); 
            cursor: pointer !important; opacity: 0.6; display: flex; align-items: center; gap: 8px; 
            white-space: nowrap;
            flex-shrink: 0; /* 禁止收缩，防止多个tab时宽度被压缩 */
            min-width: 80px; /* 设置最小宽度 */
        }
        #term-tabs .term-tab:only-child .term-close,
        #ai-tabs .term-tab:only-child .term-close {
            display: none !important;
        }
        .term-tab.active { background: var(--amber-dim); color: #fff; opacity: 1; }
        .term-close { font-size: 12px; font-weight: bold; cursor: pointer !important; color: var(--term-red); }
        .term-close:hover { color: #fff; }
        
        .term-body { flex: 1; display: none; flex-direction: column; overflow: hidden; }
        .term-body.active { display: flex; }
        .term-out { flex: 1; padding: 10px; overflow-y: auto; font-size: 12px; color: var(--amber); white-space: pre-wrap; word-break: break-all; }
        .term-input-wrap { display: flex; padding: 6px 10px; background: #000; border-top: 1px solid var(--amber-dim); gap: 10px; align-items: center; }
        .cmd-in { background: transparent; border: none; outline: none; flex: 1; height: 30px; color: #fff; font-family: inherit; cursor: text !important; }

        #ai-panel { width: 600px; border-left: 1px solid var(--amber-dim); }
        #ai-chat { flex: 1; padding: 15px; overflow-y: auto; font-size: 13px; scroll-behavior: smooth; }
        
        .msg { margin-bottom: 15px; line-height: 1.4; border-left: 2px solid var(--amber-dim); padding-left: 10px; word-wrap: break-word; overflow-wrap: break-word; white-space: pre-wrap; }
        .msg.ai { border-left-color: var(--amber); }
        .msg.user { color: #fff; opacity: 0.8; position: relative; margin-top: 20px; }
        .undo-btn { 
            position: absolute; top: -18px; left: 0; 
            color: #ff6b6b; font-size: 9px; cursor: pointer;
            background: rgba(0,0,0,0.8); padding: 2px 6px; border-radius: 3px;
        }
        
        .copy-ai-btn { 
            position: absolute; bottom: -22px; right: 0; 
            color: var(--amber); font-size: 9px; cursor: pointer;
            background: rgba(0,0,0,0.8); padding: 2px 6px; border-radius: 3px;
        }
        
        .scroll-top-btn { 
            position: absolute; bottom: -22px; right: 40px; 
            color: var(--amber); font-size: 9px; cursor: pointer;
            background: rgba(0,0,0,0.8); padding: 2px 6px; border-radius: 3px;
        }
        
        .ai-tools { padding: 8px 10px; background: rgba(113, 78, 0, 0.1); border-top: 1px solid var(--amber-dim); font-size: 10px; position: relative; }
        
        .custom-select-trigger { 
            background: #000; color: var(--amber); border: 1px solid var(--amber-dim); 
            font-size: 10px; width: 100%; padding: 6px; cursor: pointer !important;
            display: flex; justify-content: space-between; align-items: center; white-space: nowrap;
        }
        .custom-select-trigger.active span:last-child {
            transform: rotate(180deg);
        }
        .custom-select-options {
            position: absolute; bottom: 100%; left: 10px; right: 10px; background: var(--panel-bg);
            border: 1px solid var(--amber); display: none; z-index: 600; max-height: 200px; overflow-y: auto;
        }
        .custom-select-options div { padding: 8px; border-bottom: 1px solid var(--amber-dim); cursor: pointer !important; }
        .custom-select-options div:hover { background: var(--amber); color: #000; }

        .ai-input-area { padding: 10px; background: rgba(0,0,0,0.3); border-top: 1px solid var(--amber-dim); }
        #ai-in { 
            background: transparent; 
            border: 1px solid var(--amber-dim); 
            color: #fff; 
            width: 100%; 
            height: 30px;
            max-height: 120px; 
            padding: 5px; 
            outline: none; 
            cursor: text !important; 
            resize: none; 
            font-family: inherit; 
            font-size: 12px; 
            line-height: 1.4;
            margin-bottom: 5px;
        }
        .ai-input-controls { display: flex; gap: 5px; align-items: center; }
        .ai-btn { background: var(--amber); color: #000; border: none; font-size: 12px; cursor: pointer; height: 25px; }
        #agent-btn, #voice-btn { width: 30px; }
        .ai-btn:hover { background: #fff; }
        
        .template-dropdown {
            position: absolute;
            bottom: 100%;
            left: 10px;
            right: 10px;
            background: var(--panel-bg);
            border: 1px solid var(--amber);
            display: none;
            z-index: 600;
            max-height: 200px;
            overflow-y: auto;
        }
        .template-option {
            padding: 8px;
            border-bottom: 1px solid var(--amber-dim);
            cursor: pointer !important;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .template-option:hover {
            background: var(--amber);
            color: #000;
        }
        .template-actions {
            display: flex;
            gap: 5px;
        }
        .template-action {
            background: transparent;
            border: 1px solid currentColor;
            color: inherit;
            padding: 1px 4px;
            font-size: 9px;
            cursor: pointer;
            border-radius: 2px;
        }
        .template-action:hover {
            background: rgba(0,0,0,0.2);
        }
        .template-header {
            padding: 8px;
            background: var(--amber-dim);
            color: #fff;
            font-size: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--amber-dim);
        }
        .template-add-btn {
            background: var(--amber);
            color: #000;
            border: none;
            padding: 2px 6px;
            font-size: 9px;
            cursor: pointer;
            border-radius: 2px;
        }

        #ai-container .msg {
            font-size: 12px;
            margin-bottom: 10px;
        }

        .search-res-item {
            padding: 5px 10px; font-size: 11px;
            border-bottom: 1px solid rgba(113, 78, 0, 0.1);
            cursor: pointer !important;
        }
        .search-res-item:hover { background: rgba(255, 176, 0, 0.1); }
        .search-match { color: #fff; background: var(--amber-dim); padding: 0 2px; }
        .search-path { font-size: 9px; opacity: 0.5; display: block; margin-bottom: 2px; }

        .inject-btn { display: inline-block; margin-top: 8px; font-size: 9px; padding: 2px 6px; border: 1px solid var(--amber); cursor: pointer !important; color: var(--amber); }
        .inject-btn:hover { background: var(--amber); color: #000; }
        
        .ai-typing { animation: pulse 1.5s ease-in-out infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        .code-block {
            background: rgba(255, 176, 0, 0.05);
            border: 1px solid var(--amber-dim);
            border-radius: 4px;
            margin: 8px 0;
            padding: 12px;
            position: relative;
        }
        .code-lang {
            position: absolute;
            top: -10px;
            left: 10px;
            background: var(--amber);
            color: #000;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
        }
        .code-block .inject-btn, .code-block .run-btn {
            position: absolute;
            top: -10px;
            right: 55px;
            background: var(--amber);
            color: #000;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            margin: 0;
            height: 18px;
            line-height: 14px;
            box-sizing: border-box;
        }
        .code-block .inject-btn:hover, .code-block .run-btn:hover {
            background: #fff;
            color: #000;
        }
        .code-block .copy-btn {
            position: absolute;
            top: -10px;
            right: 10px;
            background: var(--amber-dim);
            color: var(--amber);
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            margin: 0;
            height: 18px;
            line-height: 14px;
            box-sizing: border-box;
        }
        .code-block .copy-btn:hover {
            background: var(--amber);
            color: #000;
        }
        
        .preview-btn {
            background: var(--amber);
            color: #000;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .preview-btn:hover {
            background: #fff;
        }
        
        body.preview-fullscreen #editor-p {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
        }
        
        body.preview-fullscreen #editor-p .term-body {
            height: 100vh !important;
        }
        .code-block pre {
            margin: 0;
            overflow-x: auto;
        }
        .code-block code {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: var(--amber);
            white-space: pre-wrap;
        }
        .inline-code {
            background: rgba(255, 176, 0, 0.1);
            padding: 1px 4px;
            border-radius: 2px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: var(--amber);
        }
        strong { color: #fff; font-weight: bold; }
        em { color: var(--amber); font-style: italic; }

        #ctx, #plugin-ctx, .custom-modal {
            position: fixed; display: none; background: var(--panel-bg);
            border: 2px solid var(--amber); z-index: 1000; min-width: 200px;
        }
        .opt { padding: 12px 15px; font-size: 12px; font-weight: bold; cursor: pointer !important; }
        .opt:hover { background: var(--amber); color: var(--bg); }
        .opt.disabled { opacity: 0.5; pointer-events: none; }

        .modal-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8); z-index: 2000; display: none;
            align-items: center; justify-content: center;
        }
        .custom-modal { display: block; position: relative; width: 320px; }
        .modal-body { padding: 20px; }
        .modal-input { width: 100%; background: #000; border: 1px solid var(--amber); color: #fff; padding: 8px; outline: none; font-family: inherit; margin-top: 10px; margin-bottom: 15px; }
        .modal-btns { display: flex; justify-content: flex-end; gap: 10px; margin-top: 5px; }
        
        .type-selector { display: flex; gap: 15px; margin-bottom: 10px; font-size: 11px; }
        .type-opt { cursor: pointer !important; display: flex; align-items: center; gap: 5px; }
        .type-opt input { cursor: pointer !important; accent-color: var(--amber); }

        .editor-tools {
            display: flex; gap: 2px; padding: 5px;
            background: rgba(28, 25, 18, 0.8);
            border-bottom: 1px solid var(--amber-dim);
            overflow-x: auto; white-space: nowrap;
            scrollbar-width: none;
        }
        

        .editor-tools::-webkit-scrollbar { display: none; }
        .key-btn {
            padding: 4px 12px;
            background: var(--bg);
            border: 1px solid var(--amber-dim);
            color: var(--amber);
            font-size: 11px;
            cursor: pointer !important;
            text-transform: uppercase;
        }
        .key-btn:active {
            background: var(--amber);
            color: var(--bg);
        }