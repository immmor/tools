<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>immmor code</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="iwe.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.50.0/min/vs/loader.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.47.0/min/vs/loader.min.js"></script>
</head>
     <body>

<div class="header">
    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <div style="display: flex; gap: 0px;">
            <div class="menu-btn" onclick="handleCtx(event, 10, 40)">FILE</div>
            <div class="menu-btn" onclick="saveZip()">ARCHIVE</div>
            <div class="menu-btn" onclick="clearTerm()">RESET</div>
        </div>
        <div style="text-shadow: 0 0 10px var(--amber); padding-right:10px;">IMMMOR</div>
    </div>
</div>

<div class="workspace">
    <aside class="panel" id="explorer">
        <div id="file-section" style="height: 50%; display:flex; flex-direction:column; overflow:hidden;">  
            <div class="p-head">
                <span>FILESYSTEM</span>
                <div class="ctrl-group">
                    <span class="ctrl" onclick="toggleSearch()" title="SEARCH_ALL">‚åï</span>
                    <span class="ctrl" onclick="toggleWorkspace()" title="SWITCH WORKSPACE">‚ßâ</span>
                    <span class="ctrl" onclick="openModal()" title="NEW NODE">+</span>
                    <span class="ctrl" onclick="toggleExplorerMax('file-section')">‚ó∞</span>
                </div>
            </div>
            <div id="search-container" style="display:none; padding: 10px; border-bottom: 1px solid var(--amber-dim);">
                <input type="text" id="global-search-in" class="modal-input" placeholder="Search all content" style="margin:0; font-size:11px;" oninput="executeGlobalSearch()">
            </div>
            <div id="file-list" oncontextmenu="handleCtx(event)"></div>
            <div id="search-results" style="display:none; overflow-y:auto; flex:1;"></div>
        </div>

        <div class="divider-v" id="v-drag-explorer"></div>

        <div id="plugin-section" style="flex: 1; display:flex; flex-direction:column; overflow:hidden;">
            <div class="p-head">
                <span>PLUGINS</span>
                <div class="ctrl-group">
                    <span class="ctrl" onclick="openPluginModal()" title="ADD PLUGIN">+</span>
                    <span class="ctrl" onclick="toggleExplorerMax('plugin-section')">‚ó∞</span>
                </div>
            </div>
            <div id="plugin-list"></div>
        </div>
    </aside>

    <div class="divider-h" id="h-drag-left"></div>

    <div id="main-stack">
        <main class="panel" id="editor-p" style="flex:1">
            <div class="p-head">
                <span>EDITOR</span>
                <div class="ctrl-group">
                    <span class="ctrl" onclick="runCurrentFile()" title="RUN_NODE" style="color:var(--amber)">‚ñ∂</span>
                    <span class="ctrl" id="preview-btn" style="display: none;" onclick="previewHtmlFile()" title="PREVIEW_HTML">P</span>
                    <span class="ctrl" onclick="toggleMax('editor-p')">‚ó∞</span>
                </div>
            </div>
            <div class="term-tabs" id="editor-tabs"></div>
            <div class="editor-tools">
            <div class="key-btn" onclick="saveCurrentFile()">SAVE</div>
            <div class="key-btn" onclick="toggleFileSearch()" title="Search (Ctrl+F)">FIND</div>
            <div class="key-btn" onclick="insertAtCursor('\t')">TAB</div>
            <div class="key-btn" onclick="execEditorCmd('undo')">UNDO</div>
            
            <div class="key-btn" onclick="editorAction('selectAll')"">ALL</div>
            <div class="key-btn" onclick="editorAction('cut')">CUT</div>
            <div class="key-btn" onclick="editorAction('copy')">COPY</div>
            <div class="key-btn" onclick="editorAction('paste')">PASTE</div>

            <div class="key-btn" onclick="insertAtCursor('{}', 1)">{ }</div>
            <div class="key-btn" onclick="insertAtCursor('()', 1)">( )</div>
            <div class="key-btn" onclick="insertAtCursor('[]', 1)">[ ]</div>
            <div class="key-btn" onclick="insertAtCursor('\'\'', 1)">' '</div>
        </div>
            <div id="editor-container" style="flex:1; display:flex; flex-direction:column; overflow:hidden;"></div>
        </main>
        
        <div class="divider-v" id="v-drag"></div>

        <footer class="panel" id="terminal">
    <div class="p-head">
        <span>TERMINAL</span>
        <div class="ctrl-group">
            <span class="ctrl" onclick="addTerminal()">+</span>
            <span class="ctrl" id="terminal-mode-btn" onclick="toggleTerminalMode()">L</span>
            <span class="ctrl" onclick="toggleMax('terminal')">‚ó∞</span>
        </div>
    </div>
    <div class="term-tabs" id="term-tabs"></div>
    <div class="editor-tools">
        <div class="key-btn" onclick="insertAtTerm('\t')">TAB</div>
        <div class="key-btn" onclick="execTermUndo()">UNDO</div>
        <div class="key-btn" onclick="termAction('selectAll')">ALL</div>
        <div class="key-btn" onclick="termAction('cut')">CUT</div>
        <div class="key-btn" onclick="termAction('copy')">COPY</div>
        <div class="key-btn" onclick="termAction('paste')">PASTE</div>

        <div class="key-btn" onclick="insertAtTerm('{}', 1)">{ }</div>
        <div class="key-btn" onclick="insertAtTerm('()', 1)">( )</div>
        <div class="key-btn" onclick="insertAtTerm('[]', 1)">[ ]</div>
        <div class="key-btn" onclick="insertAtTerm('\'\'', 1)">' '</div>
    </div>
    <div id="term-container" style="flex:1; display:flex; flex-direction:column; overflow:hidden;"></div>
</footer>
    </div>

    <div class="divider-h" id="h-drag-right"></div>

    <aside class="panel" id="ai-panel">
    <div class="p-head">
        <span>AI</span>
        <div class="ctrl-group">
            <span class="ctrl" onclick="addAiTab(true)" title="NEW CHAT">+</span>
            <span class="ctrl" onclick="openHistoryManager()" title="MANAGE HISTORY">‚â°</span>
            <span class="ctrl" onclick="openSettings()" title="CONFIG">‚öô</span>
            <span class="ctrl" onclick="toggleMax('ai-panel')">‚ó∞</span>
        </div>
    </div>
    <div class="term-tabs" id="ai-tabs"></div>
    
    <div id="ai-container" style="flex:1; display:flex; flex-direction:column; overflow:hidden;">
        </div>

    <div class="ai-tools">
    <div style="margin-bottom: 10px;">
        <label style="display:block; margin-bottom:5px">AI_CONTEXT:</label>
        <div class="custom-select-trigger" id="ai-ctx-trigger" onclick="toggleAiSelect()">
            <span id="ai-ctx-val">-- NO_CONTEXT --</span>
            <span>‚ñº</span>
        </div>
        <div class="custom-select-options" id="ai-ctx-options"></div>
    </div>
    <textarea id="ai-in" placeholder="Query..." autocomplete="off"></textarea>
        <div class="ai-input-controls">
            <button class="ai-btn" id="template-btn" onclick="toggleTemplateDropdown()">TEMP</button>
            <button class="ai-btn" id="agent-btn" onclick="toggleAgent()">÷é</button>
            <div class="template-dropdown" id="template-dropdown">
                <div class="template-header">
                    <span>ÊèêÁ§∫ËØçÊ®°Êùø</span>
                    <span class="template-close" onclick="toggleTemplateDropdown()">√ó</span>
                </div>
                <div id="template-options"></div>
            </div>
            <div class="custom-select-trigger" id="ai-provider-trigger" onclick="toggleProviderSelect()">
                <span id="active-provider-name">AI_PROVIDER</span>
                <span>‚ñº</span>
            </div>
            <div class="custom-select-options" id="ai-provider-options"></div>
            <button class="ai-btn" id="voice-btn" onclick="toggleVoiceRecognition()" title="ËØ≠Èü≥ËæìÂÖ•">üé§</button>
            <button class="ai-btn" id="ai-send-btn" onclick="handleAiSend()">SEND</button>
        </div>
</aside>

<!-- ÂèåÁ´ñÊù†ÈÄâÂå∫ÊãâÊùÜ -->
<div id="handle-start" class="selection-handle start"></div>
<div id="handle-end" class="selection-handle end"></div>
</div>

<div id="ctx">
    <div class="opt" id="ctx-new-node" onclick="openModal()">[+] NEW_FILE</div>
    <div class="opt" id="ctx-rename" onclick="startRenameFromCtx()">[R] RENAME_FILE</div>
    <div class="opt" id="ctx-delete" onclick="deleteNodeFromCtx()" style="color:var(--term-red)">[X] DELETE_NODE</div>
    <div class="opt" id="ctx-copy-path" onclick="copyPathFromCtx()">[C] COPY_PATH</div>
    <div style="border-top:1px solid var(--amber-dim); margin:4px 0;"></div>
    <div class="opt" onclick="saveFile()">DOWNLOAD_FILE</div>
    <div class="opt" onclick="saveZip()">DOWNLOAD_DIR</div>
    <div class="opt" onclick="clearTerm()">RESET_CONSOLE</div>
</div>

<div id="plugin-ctx">
    <div class="opt" onclick="renamePlugin()">[R] RENAME_PLUGIN</div>
    <div class="opt" onclick="startEditPlugin()">[E] EDIT_PLUGIN</div>
    <div class="opt" onclick="confirmDeletePlugin()" style="color:var(--term-red)">[X] UNINSTALL_PLUGIN</div>
</div>

<div id="modal-overlay" class="modal-overlay">
    <div class="custom-modal">
        <div class="p-head"><span id="modal-title">WORKSPACE</span></div>
        <div class="modal-body" id="modal-content"></div>
    </div>
</div>
</body>
<script src="index.js"></script>
</html>