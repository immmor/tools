<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™å¿ƒç¤¼ä½› Â· è™”è¯šä¾›å¥‰</title>
    <style>
        :root {
            --vermilion: #7e2217; /* æœ±ç ‚çº¢ */
            --gold: #d4af37;      /* å¤é“œé‡‘ */
            --wood: #2a1b15;      /* æª€æœ¨é»‘ */
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--wood);
            color: var(--gold);
            font-family: "STKaiti", "æ¥·ä½“", serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* æ®¿å ‚å…‰å½± */
        .temple-hall {
            position: relative;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 30%, #4a2e23 0%, #1a0f0a 80%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 40px 0;
        }

        /* åŠŸå¾·æ¦œ - ç«–æ’ */
        .merit-scroll {
            position: absolute;
            top: 50px;
            right: 50px;
            border: 2px solid var(--gold);
            padding: 20px 10px;
            writing-mode: vertical-rl;
            letter-spacing: 10px;
            font-size: 22px;
            background: rgba(0,0,0,0.4);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
        }

        /* ä½›åƒåŒºåŸŸ */
        .buddha-area {
            position: relative;
            text-align: center;
            margin-top: 20px;
        }
        .buddha-img {
            font-size: 150px;
            filter: drop-shadow(0 0 50px rgba(212, 175, 55, 0.3));
            user-select: none;
        }

        /* é¦™ç‚‰ */
        .censer-container {
            position: relative;
            width: 200px;
            height: 120px;
            background: #3d3d3d;
            border-radius: 0 0 50px 50px;
            border: 4px solid #222;
            box-shadow: inset 0 0 20px #000;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin-bottom: 100px;
        }
        .censer-label {
            position: absolute;
            bottom: 20px;
            font-size: 14px;
            color: #555;
            letter-spacing: 5px;
        }

        /* æ’å¥½çš„é¦™ */
        .incense-spot {
            width: 4px;
            height: 0;
            background: linear-gradient(to top, #800000, #ff4500);
            margin: 0 8px;
            position: relative;
            transition: height 1s;
        }
        .incense-spot.active {
            height: 80px;
        }
        .incense-spot.active::after {
            content: '';
            position: absolute;
            top: 0; left: 50%; transform: translateX(-50%);
            width: 6px; height: 6px; background: #ff4500;
            border-radius: 50%; box-shadow: 0 0 10px #ff4500;
        }

        /* å¾…æŠ½å–çš„é¦™ */
        .incense-source {
            position: absolute;
            bottom: 40px;
            display: flex;
            gap: 20px;
        }
        .stick {
            width: 6px;
            height: 120px;
            background: #800000;
            cursor: grab;
            border-radius: 3px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }
        .stick:active { cursor: grabbing; }

        /* çƒŸé›¾ Canvas */
        #smoke-canvas {
            position: absolute;
            top: -150px;
            left: 0;
            pointer-events: none;
        }

        /* é£˜åŠ¨çš„åŠŸå¾·æ–‡å­— */
        .float-text {
            position: absolute;
            color: var(--gold);
            font-size: 30px;
            font-weight: bold;
            animation: floatUp 2s ease-out forwards;
            pointer-events: none;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: translateY(-200px); opacity: 0; }
        }

        .hint {
            position: absolute;
            bottom: 20px;
            font-size: 16px;
            opacity: 0.6;
        }
    </style>
</head>
<body>

<div class="temple-hall">
    <div class="merit-scroll">
        åŠŸå¾·ç°¿ï¼š<span id="score">é›¶</span>
    </div>

    <div class="buddha-area">
        <div class="buddha-img">ğŸ§˜</div>
        <div style="margin-top: 10px; letter-spacing: 5px; opacity: 0.8;">ä¸‡å¾·åº„ä¸¥</div>
    </div>

    <div class="censer-container" id="censer">
        <canvas id="smoke-canvas" width="200" height="150"></canvas>
        <div class="incense-spot" id="spot1"></div>
        <div class="incense-spot" id="spot2"></div>
        <div class="incense-spot" id="spot3"></div>
        <div class="censer-label">å®é¼é¦™æ»¡</div>
    </div>

    <div class="incense-source">
        <div class="stick" draggable="true" ondragstart="drag(event)" id="s1"></div>
        <div class="stick" draggable="true" ondragstart="drag(event)" id="s2"></div>
        <div class="stick" draggable="true" ondragstart="drag(event)" id="s3"></div>
    </div>

    <div class="hint">â€”â€” æ‹–æ‹½é¦™ç«è‡³é¦™ç‚‰ Â· è™”è¯šä¸Šé¦™ â€”â€”</div>
</div>

<audio id="bell-sound" src="assets.mixkit.co"></audio>

<script>
    let meritCount = 0;
    let incenseCount = 0;
    const scoreEl = document.getElementById('score');
    const bell = document.getElementById('bell-sound');
    const spots = [document.getElementById('spot1'), document.getElementById('spot2'), document.getElementById('spot3')];

    // æ‹–æ‹½é€»è¾‘
    function drag(ev) {
        ev.dataTransfer.setData("text", ev.target.id);
    }

    const censer = document.getElementById('censer');
    censer.ondragover = (ev) => ev.preventDefault();
    censer.ondrop = (ev) => {
        ev.preventDefault();
        const id = ev.dataTransfer.getData("text");
        const stick = document.getElementById(id);
        
        if (stick && incenseCount < 3) {
            stick.style.visibility = 'hidden'; // ç§»é™¤ä¸‹æ–¹çš„é¦™
            spots[incenseCount].classList.add('active'); // åœ¨ç‚‰ä¸­ç‚¹ç‡ƒ
            incenseCount++;

            if (incenseCount === 3) {
                completeWorship();
            }
        }
    };

    function completeWorship() {
        meritCount++;
        scoreEl.innerText = meritCount;
        bell.currentTime = 0;
        bell.play();

        // å¼¹å‡ºåŠŸå¾·æ–‡å­—
        const text = document.createElement('div');
        text.className = 'float-text';
        text.innerText = 'åŠŸå¾·åœ†æ»¡';
        text.style.left = '50%';
        text.style.top = '40%';
        document.body.appendChild(text);

        // å¯åŠ¨çƒŸé›¾
        startSmoke();

        // 3ç§’åé‡ç½®ï¼Œå…è®¸å†æ¬¡ä¾›å¥‰
        setTimeout(() => {
            text.remove();
            resetIncense();
        }, 3000);
    }

    function resetIncense() {
        incenseCount = 0;
        spots.forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.stick').forEach(s => s.style.visibility = 'visible');
        isSmoking = false;
    }

    // çƒŸé›¾ç²’å­ç³»ç»Ÿ
    const canvas = document.getElementById('smoke-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let isSmoking = false;

    class Particle {
        constructor() {
            this.x = 100 + (Math.random() - 0.5) * 40;
            this.y = 140;
            this.size = Math.random() * 5 + 2;
            this.speedY = Math.random() * 1 + 0.5;
            this.opacity = 0.6;
        }
        update() {
            this.y -= this.speedY;
            this.x += Math.sin(this.y / 20) * 0.5;
            this.opacity -= 0.005;
        }
        draw() {
            ctx.fillStyle = `rgba(200, 200, 200, ${this.opacity})`;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    function startSmoke() {
        isSmoking = true;
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (isSmoking) {
            if (particles.length < 50) particles.push(new Particle());
        }
        particles = particles.filter(p => p.opacity > 0);
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animate);
    }
    animate();
</script>

</body>
</html>
