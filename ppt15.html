<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>immmor code: 技术白皮书</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/theme/white.min.css">
    <style>
        :root {
            --grid-color: #e0e0e0;
            --blueprint-blue: #0047ff;
            --data-text: #666;
        }
        body { background: #fff; }
        
        /* 蓝色网格背景 */
        #grid-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
        }
        #canvas-wave { position: fixed; top: 0; left: 0; z-index: 1; opacity: 0.8; }
        .reveal { z-index: 2; }

        /* 工业图表样式 */
        .blueprint-card {
            border: 1px solid #000 !important;
            padding: 0 !important;
            background: rgba(255,255,255,0.9) !important;
            text-align: left !important;
            position: relative;
        }
        .blueprint-header {
            background: #000; color: #fff; padding: 5px 15px; font-size: 0.5em;
            text-transform: uppercase; letter-spacing: 2px;
        }
        .blueprint-content { padding: 30px; }

        .reveal h2 { font-weight: 900 !important; text-transform: uppercase; border-bottom: 5px solid #000; display: inline-block; }
        .data-line { border-top: 1px dashed var(--blueprint-blue); margin: 10px 0; position: relative; }
        .data-line::after { content: 'DATA_STREAM'; position: absolute; right: 0; top: -10px; font-size: 0.3em; color: var(--blueprint-blue); }
    </style>
</head>
<body>

    <div id="grid-bg"></div>
    <canvas id="canvas-wave"></canvas>

    <div class="reveal">
        <div class="slides">

            <section>
                <div class="blueprint-card">
                    <div class="blueprint-header">Project Blueprint v2.0</div>
                    <div class="blueprint-content">
                        <h2>IMMMOR<br>CODE</h2>
                        <div class="data-line"></div>
                        <p style="font-size: 0.8em; color: var(--blueprint-blue);">基于 WASM 与虚拟 FS 的高性能离线开发环境</p>
                    </div>
                </div>
            </section>

            <section>
                <h3>01. 存储矩阵 (IndexedDB)</h3>
                <div class="blueprint-card fragment">
                    <div class="blueprint-content">
                        <p>不同于标准浏览器的沙盒，immmor 实现了：</p>
                        <div style="font-size: 0.6em; font-family: monospace;">
                            [Root] -> /workdir -> /src -> [main.py, utils.py]
                        </div>
                        <ul>
                            <li><strong>二进制透明度：</strong> 支持图片、ZIP、甚至是编译后的 <code>.pyc</code> 存储。</li>
                            <li><strong>热插拔导入：</strong> 源码中的 <code>input[type="file"]</code> 监听器实现了“零延迟文件挂载”。</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section>
                <h3>02. 编辑器内核调优</h3>
                <div class="blueprint-card fragment">
                    <div class="blueprint-content">
                        <p>源码通过 <code>require(['vs/editor/editor.main'])</code> 实现了以下深度定制：</p>
                        <ul style="font-size: 0.7em;">
                            <li><strong>多模型关联：</strong> 一个 Monaco 实例管理 <code>openedTabs</code> 数组中的所有 Buffer，切换时零抖动。</li>
                            <li><strong>主题动态注入：</strong> 通过 <code>monaco.editor.defineTheme</code> 完美契合系统的琥珀色视觉。</li>
                            <li><strong>自动对齐：</strong> 监听 <code>window.resize</code>，确保侧边栏拖动时编辑器自动重绘。</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section>
                <h3>03. 智能上下文注入</h3>
                <div class="blueprint-card">
                    <div class="blueprint-content">
                        <p>当你按下 AI 询问按钮时，系统在后台执行：</p>
                        <div class="data-line"></div>
                        <ol style="font-size: 0.6em;">
                            <li>获取当前编辑器选中的代码片段。</li>
                            <li>自动扫描 <code>PROTOCOL.txt</code> 或配置文件中的开发约定。</li>
                            <li>合并用户 Prompt，通过 <code>fetch</code> 异步推送到选定的 AI Provider。</li>
                        </ol>
                        <p><small style="color: var(--blueprint-blue);">* 这是一个典型的“RAG-lite”端侧实现。</small></p>
                    </div>
                </div>
            </section>

            <section>
                <h3>04. 跨平台资产处理</h3>
                <div style="display: flex; gap: 20px;">
                    <div class="blueprint-card fragment" style="flex: 1;">
                        <div class="blueprint-header">ZIP COMPRESSION</div>
                        <div class="blueprint-content">
                            <small>使用 <code>JSZip</code> 在浏览器主线程外进行数据压缩，不卡顿、不溢出。</small>
                        </div>
                    </div>
                    <div class="blueprint-card fragment" style="flex: 1;">
                        <div class="blueprint-header">BLOB DOWNLOAD</div>
                        <div class="blueprint-content">
                            <small>通过 <code>URL.createObjectURL</code> 实现浏览器端直接下载，无需经过服务器。</small>
                        </div>
                    </div>
                </div>
            </section>

            <section data-background-color="#0047ff">
                <h2 style="color: white !important; border-color: white;">FINAL_STATUS: READY</h2>
                <p style="color: rgba(255,255,255,0.7);">immmor code - 重新定义 Web 开发体验</p>
            </section>

        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        Reveal.initialize({ center: true, hash: true, transition: 'slide' });

        // Three.js 蓝色波浪线
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas-wave'), antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        const group = new THREE.Group();
        const points = [];
        for(let i=0; i<100; i++) {
            const geo = new THREE.SphereGeometry(0.02, 8, 8);
            const mat = new THREE.MeshBasicMaterial({ color: 0x0047ff });
            const sphere = new THREE.Mesh(geo, mat);
            sphere.position.x = (i / 10) - 5;
            group.add(sphere);
            points.push(sphere);
        }
        scene.add(group);
        camera.position.z = 5;

        function animate() {
            requestAnimationFrame(animate);
            points.forEach((p, i) => {
                p.position.y = Math.sin(Date.now()*0.002 + i*0.5) * 1;
                p.position.z = Math.cos(Date.now()*0.002 + i*0.5) * 1;
            });
            group.rotation.y += 0.005;
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>