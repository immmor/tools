<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
    <style>
        #container { width: 100vw; height: 90vh; }
        body { margin: 0; overflow: hidden; }
    </style>
</head>
<body>
    <div id="container"></div>

    <script>
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' }});

        require(['vs/editor/editor.main'], function() {
            const editor = monaco.editor.create(document.getElementById('container'), {
                value: "// 尝试在手机上长按这段文字\nfunction helloWorld() {\n    console.log('Hello Monaco on Mobile!');\n    // 这里的长文本测试选中：Lorem ipsum dolor sit amet, consectetur adipiscing elit.\n}",
                language: 'javascript',
                theme: 'vs-dark',
                fontSize: 16,
                contextmenu: false,       // 禁用内置右键菜单，防止干扰
                smoothScrolling: true,
                automaticLayout: true,
                fixedOverflowWidgets: true // 确保弹出框不会被遮挡
            });

            // --- 移动端长按选中逻辑 ---
            let touchTimer = null;
            const domNode = editor.getDomNode();

            domNode.addEventListener('touchstart', (e) => {
                // 如果是多指触控不处理
                if (e.touches.length > 1) return;

                const touch = e.touches[0];
                
                // 设置长按定时器（500ms）
                touchTimer = setTimeout(() => {
                    // 获取触碰点在编辑器中的位置
                    const target = editor.getTargetAtClientPoint(touch.clientX, touch.clientY);
                    
                    if (target && target.position) {
                        const pos = target.position;
                        // 逻辑：选中当前点击的单词
                        const model = editor.getModel();
                        const word = model.getWordAtPosition(pos);

                        if (word) {
                            editor.setSelection({
                                startLineNumber: pos.lineNumber,
                                startColumn: word.startColumn,
                                endLineNumber: pos.lineNumber,
                                endColumn: word.endColumn
                            });
                            // 震动反馈（如果手机支持）
                            if (navigator.vibrate) navigator.vibrate(50);
                        }
                    }
                }, 500);
            }, { passive: true });

            domNode.addEventListener('touchmove', () => {
                clearTimeout(touchTimer); // 滑动时取消长按
            }, { passive: true });

            domNode.addEventListener('touchend', () => {
                clearTimeout(touchTimer); // 手抬起时取消定时器
            }, { passive: true });
        });
    </script>
</body>
</html>